# 금액 & 반올림

> 시스템이 금액을 처리하고, 반올림 오류를 방지하며, 호주 5센트 반올림을 적용하는 방법입니다.

---

## 정밀도

모든 금액 계산은 **decimal.js**를 사용합니다 — 임의 정밀도 십진 연산 라이브러리입니다. 표준 JavaScript 숫자에서 발생하는 부동소수점 오류를 방지합니다 (예: `0.1 + 0.2 ≠ 0.3`).

### 저장 형식

| 위치 | 형식 | 예시 |
|------|------|------|
| Invoice 금액 | Decimal(18,2) (데이터베이스) | `$15.50` → `15.50`으로 저장 |
| Shift 금액 | 정수 (센트) | `$15.50` → `1550`으로 저장 |
| Cash In/Out 금액 | Decimal(18,2) | `$15.50` → `15.50`으로 저장 |
| 가격 | Float 배열 | `[5.99, 4.99, 3.99]` |

### Shift에 센트를 사용하는 이유

Shift 합계는 많은 거래를 누적합니다. 정수(센트)를 사용하면 누적 반올림 오류의 가능성을 완전히 제거합니다. 변환은:
- **센트로**: shift 마감 시 `Math.round(달러 × 100)`
- **달러로**: 표시 시 `센트 ÷ 100`

---

## 5센트 반올림 (호주 규칙)

호주는 1센트 및 2센트 동전을 폐지했습니다. Cash 거래는 가장 가까운 5센트로 반올림됩니다.

### 반올림 적용 시점

- **Cash 결제가 있는 경우** → 결제액을 가장 가까운 5센트로 반올림
- **Credit 전액 결제인 경우** → 반올림 없음 (정확한 금액 청구)

### 작동 방식

```
Rounded Due = Exact Due를 가장 가까운 $0.05로 반올림 (반올림)
Rounding = Rounded Due − Exact Due
```

| Exact Due | Rounded Due | Rounding |
|-----------|------------|----------|
| $10.01 | $10.00 | −$0.01 |
| $10.02 | $10.00 | −$0.02 |
| $10.03 | $10.05 | +$0.02 |
| $10.04 | $10.05 | +$0.01 |
| $10.05 | $10.05 | $0.00 |

---

## GST (Goods and Services Tax)

호주 GST는 **10%, 세금 포함가**입니다. 표시 가격에 이미 세금이 포함되어 있습니다.

### GST 추출

```
GST = 가격 ÷ 11
```

`가격 × 10%`가 아닙니다 — 세금이 이미 가격에 포함되어 있으므로, 11로 나누면 정확하게 추출됩니다.

### 줄별 세금 배분

여러 상품에 세금을 배분할 때 시스템은 **최대 잔여법**을 사용하여 줄별 세금 합계가 정확히 총합과 일치하도록 합니다:

1. 각 줄의 비례 배분 계산
2. 소수점 2자리로 내림
3. 남은 센트를 소수 잔여분이 가장 큰 줄부터 배분

이는 각 줄을 독립적으로 반올림할 때 합계가 1-2센트 차이나는 일반적인 문제를 방지합니다.

---

## 소수 자릿수

| 유형 | 소수 자릿수 |
|------|------------|
| 금액 (가격, 합계) | 2 |
| 수량 | 3 |
| 무게 | 3 |
