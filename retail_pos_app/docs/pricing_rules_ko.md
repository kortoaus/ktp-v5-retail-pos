# 가격 계산 규칙

POS에서 가격이 어떻게 계산되는지 설명합니다.

---

## 상품 유형

| 유형 | 설명 | 예시 |
|------|------|------|
| **일반 (Normal)** | 선반에 진열된 일반 상품 | 우유 1병 |
| **계량 (Weight)** | 계산대에서 저울로 무게를 재는 상품 | 낱개 바나나 |
| **팩 (Prepacked)** | 미리 포장되어 라벨에 가격이 붙어있는 상품 | 가격 스티커가 붙은 다진고기 팩 |
| **계량팩 (Weight-prepacked)** | 저울 시스템에서 라벨 출력된 상품 | CAS 저울에서 포장된 델리 고기 |

---

## 모든 항목에는 3가지 가격이 있습니다

영수증의 각 줄에는 3가지 가격이 있으며, 시스템은 항상 위에서부터 첫 번째로 있는 가격을 사용합니다:

| 우선순위 | 이름 | 설명 | 누가 설정? | 변경 가능? |
|---------|------|------|-----------|-----------|
| 1순위 | **수동가 (Adjusted)** | 직원이 직접 입력한 가격 | 직원 | 직원만 변경 가능 |
| 2순위 | **할인가 (Discounted)** | 가장 좋은 할인 가격 | 시스템 | 멤버 레벨 변경 시 자동 변경 |
| 3순위 | **정가 (Original)** | 기본 소매가 (레벨 0) | 시스템 | 변경 불가 — 상품 추가 시 고정 |

**고객이 내는 금액 = 우선순위에서 첫 번째로 존재하는 가격**

수동가가 있으면 → 수동가로 결제.
수동가가 없고 할인가가 있으면 → 할인가로 결제.
둘 다 없으면 → 정가로 결제.

---

## 정가 (고정)

정가는 항상 **레벨 0 소매가**입니다. 멤버 레벨이 바뀌어도 절대 변하지 않습니다.

할인 적용 전의 "원래 가격"입니다.

---

## 할인가 (레벨에 따라 변경)

멤버 레벨이 설정되면, 시스템이 가장 좋은 할인가를 찾습니다:

- **멤버가** = 해당 레벨의 가격
- **프로모가** = 해당 레벨의 프로모션 가격

시스템은 **둘 중 더 낮은 가격**을 선택합니다. 단, 정가보다 낮아야 합니다. 둘 다 정가 이상이면 할인 없음.

**예시 — 우유:**

| | 레벨 0 | 레벨 1 | 레벨 2 |
|---|--------|--------|--------|
| 일반가 | $4.50 | $4.00 | $3.50 |
| 프로모가 | $4.20 | $3.80 | $3.20 |

- 레벨 0: 정가 = $4.50. 할인가 = $4.20 (프로모가 더 쌈). 고객 결제금액 **$4.20**.
- 레벨 1: 정가 = $4.50. 할인가 = $3.80 (프로모 $3.80 < 멤버 $4.00). 고객 결제금액 **$3.80**.
- 레벨 2: 정가 = $4.50. 할인가 = $3.20 (프로모 $3.20 < 멤버 $3.50). 고객 결제금액 **$3.20**.

프로모가 없는 경우:
- 레벨 0: 정가 = $4.50. 할인 없음 (멤버가 = 정가). 고객 결제금액 **$4.50**.
- 레벨 1: 정가 = $4.50. 할인가 = $4.00 (멤버가). 고객 결제금액 **$4.00**.

---

## 수량 계산 방식

| 유형 | 수량은... | 예시 |
|------|----------|------|
| 일반 | 스캔 횟수 | 3번 스캔 → 수량 = 3 |
| 계량 | 저울에서 읽은 무게 (kg) | 저울 1.250 kg → 수량 = 1.250 |
| 팩 | 라벨 가격 ÷ 레벨 0 가격 | 라벨 $28, 정가 $28/개 → 수량 = 1.000 |
| 계량팩 | 라벨 가격 ÷ kg당 레벨 0 가격 | 라벨 $19.50, 정가 $6.50/kg → 수량 = 3.000 |

팩과 계량팩은 바코드 라벨 가격에서 역산하여 수량을 계산합니다. 라벨 가격은 항상 레벨 0 정가 기준입니다.

**합계 = 적용 가격 × 수량**

참고: 팩과 계량팩은 영수증에 항상 **수량 = 1**로 표시됩니다. 역산된 수량은 내부 가격 계산용으로만 사용됩니다.

---

## 팩 / 계량팩 상세 설명

### 자체 상품 (우리가 가격을 관리하는 상품)

시스템에 가격이 등록된 상품입니다 (레벨 0 가격 > $0).

바코드 라벨의 가격은 **레벨 0 가격 × 수량**으로 계산된 것입니다.

시스템은 이를 역산합니다: **라벨 가격 ÷ 레벨 0 가격 = 수량**.

이 시점부터는 일반 상품과 동일하게 동작합니다 — 정가는 레벨 0 가격이고, 멤버/프로모 할인이 정상 적용됩니다.

**예시 — YJ 순살치킨 (팩):**
- 라벨 가격: $28.00
- 레벨 0 가격: $28.00/개
- 수량: $28.00 ÷ $28.00 = 1.000
- 프로모가: [27, 24, 19, ...]

| 레벨 | 정가 | 할인가 | 수량 | 합계 |
|------|------|--------|------|------|
| 0 | $28.00 | $27.00 (프로모) | 1.000 | $27.00 |
| 1 | $28.00 | $24.00 (프로모) | 1.000 | $24.00 |
| 2 | $28.00 | $19.00 (프로모) | 1.000 | $19.00 |

**예시 — 불고기용 소고기 (계량팩, 자체가격):**
- 라벨 가격: $19.50
- 레벨 0 가격: $6.50/kg
- 수량: $19.50 ÷ $6.50 = 3.000 kg
- 레벨 1 가격: $5.50/kg, 프로모: $5.00/kg

| 레벨 | 정가 | 할인가 | 수량 | 합계 |
|------|------|--------|------|------|
| 0 | $6.50 | — | 3.000 | $19.50 |
| 1 | $6.50 | $5.00 (프로모) | 3.000 | $15.00 |

### 납품 상품 (가격을 관리하지 않는 상품)

시스템에 가격이 모두 $0으로 등록된 상품입니다. 라벨 가격이 유일한 가격입니다.

시스템은 라벨 가격을 정가로 사용하고, 수량은 1이며, 할인은 절대 적용되지 않습니다. 멤버 레벨을 바꿔도 영향 없음.

**예시 — 수입 와규 (납품 팩):**
- 라벨 가격: $45.00
- 시스템 가격: 전부 $0

| 레벨 | 정가 | 할인가 | 수량 | 합계 |
|------|------|--------|------|------|
| 전체 | $45.00 | — | 1 | $45.00 |

---

## 세금 (GST)

모든 가격은 GST 포함 가격입니다. 합계에서 세금을 추출합니다:

- **GST = 합계 ÷ 11**
- **세전금액 = 합계 − GST**

예시: 합계 = $19.50 → GST = $1.77, 세전금액 = $17.73

비과세 상품: GST = $0, 세전금액 = 합계.

---

## 요약

| | 정가 | 할인가 | 수량 | 레벨 변경 시 |
|---|------|--------|------|------------|
| **일반** | 레벨 0 가격 | 멤버/프로모 중 낮은 가격 | 스캔 횟수 | 할인가만 변경 |
| **계량** | kg당 레벨 0 가격 | 멤버/프로모 중 낮은 가격 | 저울 무게 | 할인가만 변경 |
| **팩 (자체)** | 레벨 0 가격 | 멤버/프로모 중 낮은 가격 | 라벨 ÷ 레벨 0 가격 | 할인가만 변경 |
| **계량팩 (자체)** | kg당 레벨 0 가격 | 멤버/프로모 중 낮은 가격 | 라벨 ÷ 레벨 0 가격 | 할인가만 변경 |
| **팩 (납품)** | 라벨 가격 | 없음 | 1 | 변경 없음 |
